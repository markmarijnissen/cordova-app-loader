var CordovaAppLoader=function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return t[o].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){function o(t){var e=Object.keys(t);e.sort();var n="";return e.forEach(function(e){t[e]&&t[e].version,n+="@"+t[e].version}),i.hash(n)+""}function r(t){if(!t)throw new Error("CordovaAppLoader has no options!");if(!t.fs)throw new Error('CordovaAppLoader has no "fs" option (cordova-promise-fs)');if(!t.serverRoot)throw new Error('CordovaAppLoader has no "serverRoot" option.');if(!window.pegasus||!window.Manifest)throw new Error("CordovaAppLoader bootstrap.js is missing.");this.allowServerRootFromManifest=t.allowServerRootFromManifest===!0,a=t.fs.Promise,this.manifest=window.Manifest,this.newManifest=null,this.bundledManifest=null,this._lastUpdateFiles=localStorage.getItem("last_update_files"),t.serverRoot=t.serverRoot||"",t.serverRoot&&"/"!==t.serverRoot[t.serverRoot.length-1]&&(t.serverRoot+="/"),this.newManifestUrl=t.manifestUrl||t.serverRoot+(t.manifest||"manifest.json"),t.mode&&(t.mode="mirror"),this.cache=new i(t),this.corruptNewManifest=!1,this._toBeCopied=[],this._toBeDeleted=[],this._toBeDownloaded=[],this._updateReady=!1,this._checkTimeout=t.checkTimeout||1e4}var i=n(1),a=(n(3),null),s=location.href.replace(location.hash,"");s=s.substr(0,s.lastIndexOf("/")+1),/ip(hone|ad|od)/i.test(navigator.userAgent)&&(s=location.pathname.substr(location.pathname.indexOf("/www/")),s=s.substr(0,s.lastIndexOf("/")+1),s="cdvfile://localhost/bundle"+s),r.prototype._createFilemap=function(t){var e={},n=this.cache._fs.normalize;return Object.keys(t).forEach(function(o){t[o].filename=n(t[o].filename),e[t[o].filename]=t[o]}),e},r.prototype.copyFromBundle=function(t){var e=s+t;return this.cache._fs.download(e,this.cache.localRoot+t)},r.prototype.getBundledManifest=function(){var t=this,e=document.querySelector("script[manifest]"),n=(e?e.getAttribute("manifest"):null)||"manifest.json";return new a(function(e,o){t.bundledManifest?e(t.bundledManifest):(pegasus(n).then(function(n){t.bundledManifest=n,e(n)},o),setTimeout(function(){o(new Error("bundled manifest timeout"))},t._checkTimeout))})},r.prototype.check=function(t){var e=this,n=this.manifest;"string"==typeof t&&(e.newManifestUrl=t,t=void 0);var r=new a(function(n,o){"object"==typeof t?n(t):(pegasus(e.newManifestUrl).then(n,o),setTimeout(function(){o(new Error("new manifest timeout"))},e._checkTimeout))});return new a(function(t,i){a.all([r,e.getBundledManifest(),e.cache.list()]).then(function(r){var a=r[0],s=r[1],u=o(a.files);if(u===e._lastUpdateFiles){var c=o(Manifest.files);return e._lastUpdateFiles!==c&&(console.warn("New manifest available, but an earlier update attempt failed. Will not download."),e.corruptNewManifest=!0,t(null)),void t(!1)}if(!a.files)return void i('Downloaded Manifest has no "files" attribute.');var f=r[2],l=e._createFilemap(n.files),u=e._createFilemap(a.files),d=e._createFilemap(s.files);e._toBeDownloaded=[],e._toBeCopied=[],e._toBeDeleted=[];var h=e.cache._fs.isCordova;Object.keys(u).filter(function(t){return!l[t]||l[t].version!==u[t].version||!e.cache.isCached(t)}).forEach(function(t){h&&d[t]&&d[t].version===u[t].version?e._toBeCopied.push(t):e._toBeDownloaded.push(t)}),e._toBeDeleted=f.map(function(t){return t.substr(e.cache.localRoot.length)}).filter(function(t){return!u[t]||e._toBeDownloaded.indexOf(t)>=0||e._toBeCopied.indexOf(t)>=0});var p=e._toBeDeleted.length+e._toBeDownloaded.length;p>0?(e.newManifest=a,e.newManifest.root=e.cache.localInternalURL,t(!0)):t(!1)},function(t){i(t)})})},r.prototype.canDownload=function(){return!!this.newManifest&&!this._updateReady},r.prototype.canUpdate=function(){return this._updateReady},r.prototype.download=function(t){var e=this;return e.canDownload()?(localStorage.removeItem("manifest"),localStorage.setItem("last_update_files",o(this.newManifest.files)),this.manifest.files=Manifest.files={},e.cache.remove(e._toBeDeleted,!0).then(function(){return a.all(e._toBeCopied.map(function(t){return e.cache._fs.download(s+t,e.cache.localRoot+t)}))}).then(function(){return e.allowServerRootFromManifest&&e.newManifest.serverRoot&&(e.cache.serverRoot=e.newManifest.serverRoot),e.cache.add(e._toBeDownloaded),e.cache.download(t)}).then(function(){return e._toBeDeleted=[],e._toBeDownloaded=[],e._updateReady=!0,e.newManifest},function(t){return t&&t.length&&e.cache.remove(t),t})):new a(function(t){t(null)})},r.prototype.update=function(t){return this._updateReady?(localStorage.setItem("manifest",JSON.stringify(this.newManifest)),t!==!1&&location.reload(),!0):!1},r.prototype.clear=function(){return localStorage.removeItem("last_update_files"),localStorage.removeItem("manifest"),this.cache.clear()},r.prototype.reset=function(){return this.clear().then(function(){location.reload()},function(){location.reload()})},t.exports=r},function(t,e,n){function o(t){var e=this;if(this._fs=t.fs,!this._fs)throw new Error('Missing required option "fs". Add an instance of cordova-promise-fs.');i=this._fs.Promise,this._mirrorMode="hash"!==t.mode,this._retry=t.retry||[500,1500,8e3],this._cacheBuster=!!t.cacheBuster,this.localRoot=this._fs.normalize(t.localRoot||"data"),this.serverRoot=this._fs.normalize(t.serverRoot||""),this._downloading=[],this._added=[],this._cached={},this.ready=this._fs.ensure(this.localRoot).then(function(t){return e.localInternalURL=a?t.toInternalURL():t.toURL(),e.localUrl=t.toURL(),e.list()})}var r=n(2),i=null,a="undefined"!=typeof cordova;o.hash=r,o.prototype.list=function(){var t=this;return new i(function(e,n){t._fs.list(t.localRoot,"rfe").then(function(n){t._cached={},n=n.map(function(e){var n=t._fs.normalize(e.fullPath);return t._cached[n]={toInternalURL:a?e.toInternalURL():e.toURL(),toURL:e.toURL()},n}),e(n)},function(){e([])})})},o.prototype.add=function(t){t||(t=[]),"string"==typeof t&&(t=[t]);var e=this;return t.forEach(function(t){t=e.toServerURL(t),-1===e._added.indexOf(t)&&e._added.push(t)}),e.isDirty()},o.prototype.remove=function(t,e){t||(t=[]);var n=[];"string"==typeof t&&(t=[t]);var o=this;return t.forEach(function(t){var e=o._added.indexOf(o.toServerURL(t));e>=0&&o._added.splice(e,1);var r=o.toPath(t);n.push(o._fs.remove(r)),delete o._cached[r]}),e?i.all(n):o.isDirty()},o.prototype.getDownloadQueue=function(){var t=this,e=t._added.filter(function(e){return!t.isCached(e)});return e},o.prototype.getAdded=function(){return this._added},o.prototype.isDirty=function(){return this.getDownloadQueue().length>0},o.prototype.download=function(t){var e=this._fs,n=this;return n.abort(),new i(function(o,r){e.ensure(n.localRoot).then(function(){return n.list()}).then(function(){if(!n.isDirty())return void o(n);var i=n.getDownloadQueue(),a=n._downloading.length,s=n._downloading.length+i.length;i.forEach(function(i){var u,c=n.toPath(i);"function"==typeof t&&(u=function(e){e.queueIndex=a,e.queueSize=s,e.url=i,e.path=c,e.percentage=a/s,e.loaded>0&&e.total>0&&a!==s&&(e.percentage+=e.loaded/e.total/s),t(e)});var f=function(){a++,a===s&&(n._downloading=[],n.list().then(function(){u&&u(new ProgressEvent),n.isDirty()?r(n.getDownloadQueue()):o(n)},r))},l=i;n._cacheBuster&&(l+="?"+Date.now());var d=e.download(l,c,{retry:n._retry},u);d.then(f,f),n._downloading.push(d)})},r)})},o.prototype.abort=function(){this._downloading.forEach(function(t){t.abort()}),this._downloading=[]},o.prototype.isCached=function(t){return t=this.toPath(t),!!this._cached[t]},o.prototype.clear=function(){var t=this;return this._cached={},this._fs.removeDir(this.localRoot).then(function(){return t._fs.ensure(t.localRoot)})},o.prototype.toInternalURL=function(t){return path=this.toPath(t),this._cached[path]?this._cached[path].toInternalURL:t},o.prototype.get=function(t){return path=this.toPath(t),this._cached[path]?this._cached[path].toInternalURL:this.toServerURL(t)},o.prototype.toDataURL=function(t){return this._fs.toDataURL(this.toPath(t))},o.prototype.toURL=function(t){return path=this.toPath(t),this._cached[path]?this._cached[path].toURL:t},o.prototype.toServerURL=function(t){return t=this._fs.normalize(t),t.indexOf("://")<0?this.serverRoot+t:t},o.prototype.toPath=function(t){if(this._mirrorMode){var e=t.indexOf("?");return e>-1&&(t=t.substr(0,e)),t=t=this._fs.normalize(t||""),len=this.serverRoot.length,t.substr(0,len)!==this.serverRoot?this.localRoot+t:this.localRoot+t.substr(len)}return this.localRoot+r(t)+t.substr(t.lastIndexOf("."))},t.exports=o},function(t,e){function n(t,e){var n,o,r,i,a,s,u,c;for(n=3&t.length,o=t.length-n,r=e,a=3432918353,s=461845907,c=0;o>c;)u=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295,u=u<<15|u>>>17,u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295,r^=u,r=r<<13|r>>>19,i=5*(65535&r)+((5*(r>>>16)&65535)<<16)&4294967295,r=(65535&i)+27492+(((i>>>16)+58964&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(c+2))<<16;case 2:u^=(255&t.charCodeAt(c+1))<<8;case 1:u^=255&t.charCodeAt(c),u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295,u=u<<15|u>>>17,u=(65535&u)*s+(((u>>>16)*s&65535)<<16)&4294967295,r^=u}return r^=t.length,r^=r>>>16,r=2246822507*(65535&r)+((2246822507*(r>>>16)&65535)<<16)&4294967295,r^=r>>>13,r=3266489909*(65535&r)+((3266489909*(r>>>16)&65535)<<16)&4294967295,r^=r>>>16,r>>>0}t.exports=n},function(t,e){function n(t,e,o,r){t.getDirectory(e[0],{create:!0},function(t){e.length>1?n(t,e.slice(1),o,r):o(t)},r)}function o(t){return t=t.substr(0,t.lastIndexOf("/")+1),"/"===t[0]&&(t=t.substr(1)),t}function r(t){return t.substr(t.lastIndexOf("/")+1)}function i(t){return t=t||"","/"===t[0]&&(t=t.substr(1)),t&&t.indexOf(".")<0&&"/"!==t[t.length-1]&&(t+="/"),"./"===t&&(t=""),t}var a=[],s=0;t.exports=function(t){function e(t){return new B(function(e){return e(t)})}function u(t){return new B(function(e,o){return O.then(function(r){t?(t=t.split("/").filter(function(t){return t&&t.length>0&&"."!==t&&".."!==t}),n(r.root,t,e,o)):e(r.root)},o)})}function c(t,e){return new B(function(n,o){return"object"==typeof t?n(t):(t=i(t),e=e||{},O.then(function(r){r.root.getFile(t,e,n,o)},o))})}function f(t,e){return t=i(t),e=e||{},new B(function(n,o){return O.then(function(r){t&&"/"!==t?r.root.getDirectory(t,e,n,o):n(r.root)},o)})}function l(t,n){n=n||"";var o=n.indexOf("r")>-1,r=n.indexOf("e")>-1,i=n.indexOf("f")>-1,a=n.indexOf("d")>-1;return i&&a&&(i=!1,a=!1),new B(function(n,s){return f(t).then(function(t){var u=t.createReader();u.readEntries(function(t){var u=[e(t)];o&&t.filter(function(t){return t.isDirectory}).forEach(function(t){u.push(l(t.fullPath,"re"))}),B.all(u).then(function(t){var e=[];e=e.concat.apply(e,t),i&&(e=e.filter(function(t){return t.isFile})),a&&(e=e.filter(function(t){return t.isDirectory})),r||(e=e.map(function(t){return t.fullPath})),n(e)},s)},s)},s)})}function d(t){return new B(function(e,n){c(t).then(function(t){e(t)},function(t){1===t.code?e(!1):n(t)})})}function h(t){return new B(function(e,n){f(t).then(function(t){e(t)},function(t){1===t.code?e(!1):n(t)})})}function p(t){return u(o(t)).then(function(){return c(t,{create:!0})})}function w(t){return c(t).then(function(t){return t.toURL()})}function v(t,e){return e=e||"readAsText",c(t).then(function(t){return new B(function(n,o){t.file(function(t){var o=new FileReader;o.onloadend=function(){n(this.result)},o[e](t)},o)})})}function m(t){return v(t,"readAsDataURL")}function y(t){return v(t).then(JSON.parse)}function _(t,e,n){return u(o(t)).then(function(){return c(t,{create:!0})}).then(function(t){return new B(function(o,r){t.createWriter(function(t){t.onwriteend=o,t.onerror=r,"string"==typeof e?e=new Blob([e],{type:n||"text/plain"}):e instanceof Blob!=!0&&(e=new Blob([JSON.stringify(e,null,4)],{type:n||"application/json"})),t.write(e)},r)})})}function g(t,e){return u(o(e)).then(function(n){return c(t).then(function(t){return new B(function(o,i){t.moveTo(n,r(e),o,i)})})})}function R(t,e){return t=t.replace(/\/$/,""),e=e.replace(/\/$/,""),u(o(e)).then(function(n){return f(t).then(function(t){return new B(function(o,i){t.moveTo(n,r(e),o,i)})})})}function b(t,e){return u(o(e)).then(function(n){return c(t).then(function(t){return new B(function(o,i){t.copyTo(n,r(e),o,i)})})})}function S(t,e){var n=e?c:d;return new B(function(e,o){n(t).then(function(t){t!==!1?t.remove(e,o):e(1)},o)}).then(function(t){return 1===t?!1:!0})}function D(t){return f(t).then(function(t){return new B(function(e,n){t.removeRecursively(e,n)})})}function U(){for(;a.length>0&&s<t.concurrency;){s++;var e=a.pop(),n=e.shift(),o=e.shift(),r=e.shift(),i=e.shift(),u=e.shift(),c=e.shift(),f=e.shift(),l=e.shift();n._aborted?s--:o?(n.download.call(n,r,i,u,c,f,l),n.onprogress&&n.onprogress(new ProgressEvent)):n.upload.call(n,i,r,u,c,l,f)}}function L(t){return s--,U(),t}function x(e,n,o,i,u){"function"==typeof i&&(u=i,i={}),E&&o.indexOf("://")<0&&(o=P(o)),i=i||{},i.retry&&i.retry.length||(i.retry=t.retry),i.retry=i.retry.concat(),i.file||e||(i.fileName=r(o));var c=new FileTransfer;u=u||i.onprogress,"function"==typeof u&&(c.onprogress=u);var f=new B(function(t,r){var u=function(s){if(0===i.retry.length)r(s);else{a.unshift([c,e,n,o,t,u,i.trustAllHosts||!1,i]);var f=i.retry.shift();f>0?setTimeout(L,f):L()}};i.retry.unshift(0),s++,u()});return f.then(L,L),f.progress=function(t){return c.onprogress=t,f},f.abort=function(){return c._aborted=!0,c.abort(),f},f}function M(t,e,n,o){return x(!0,t,e,n,o)}function F(t,e,n,o){return x(!1,e,t,n,o)}var B=t.Promise||window.Promise;if(!B)throw new Error("No Promise library given in options.Promise");this.options=t=t||{},t.persistent=void 0!==t.persistent?t.persistent:!0,t.storageSize=t.storageSize||20971520,t.concurrency=t.concurrency||3,t.retry=t.retry||[];var C,E="undefined"!=typeof cordova;E?C=new B(function(t,e){document.addEventListener("deviceready",t,!1),setTimeout(function(){e(new Error("deviceready has not fired after 5 seconds."))},5100)}):(C=e(!0),"undefined"!=typeof webkitRequestFileSystem?(window.requestFileSystem=webkitRequestFileSystem,window.FileTransfer=function(){},FileTransfer.prototype.download=function(t,e,n,o){var r=new XMLHttpRequest;return r.open("GET",t),r.responseType="blob",r.onreadystatechange=function(t,i,a){4==r.readyState&&(200===r.status?_(e,r.response).then(n,o):o(r.status))},r.send(),r},window.ProgressEvent=function(){},window.FileEntry=function(){}):window.requestFileSystem=function(t,e,n,o){o(new Error("requestFileSystem not supported!"))});var O=new B(function(e,n){C.then(function(){var o=t.persistent?1:0;"number"==typeof t.fileSystem&&(o=t.fileSystem),!E&&o>1&&(console.warn('Chrome does not support fileSystem "'+o+'". Falling back on "0" (temporary).'),o=0),!E&&1===o&&navigator.webkitPersistentStorage?navigator.webkitPersistentStorage.requestQuota(t.storageSize,function(t){window.requestFileSystem(o,t,e,n)}):window.requestFileSystem(o,t.storageSize,e,n),setTimeout(function(){n(new Error("Could not retrieve FileSystem after 5 seconds."))},5100)},n)});O.then(function(t){window.__fs=t},function(t){console.error("Could not get Cordova FileSystem:",t)});var I,P;return E?(P=function(e){return e=i(e),e.indexOf("://")<0?"cdvfile://localhost/"+(t.persistent?"persistent/":"temporary/")+e:e},I=function(t){return c(t).then(function(t){return t.toInternalURL()})}):(P=function(e){return e=i(e),"filesystem:"+location.origin+(t.persistent?"/persistent/":"/temporary/")+e},I=function(t){return c(t).then(function(t){return t.toURL()})}),{fs:O,normalize:i,file:c,filename:r,dir:f,dirname:o,create:p,read:v,readJSON:y,write:_,move:g,moveDir:R,copy:b,remove:S,removeDir:D,list:l,ensure:u,exists:d,existsDir:h,download:M,upload:F,toURL:w,isCordova:E,toInternalURLSync:P,toInternalURL:I,toDataURL:m,deviceready:C,options:t,Promise:B}}}]);
